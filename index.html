<!DOCTYPE html>
<meta charset="utf-8">
<!-- https://www.d3-graph-gallery.com/graph/backgroundmap_leaflet_buttonLayer.html -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
<script src="https://d3js.org/d3.v5.min.js"></script>

<div id="mapid" class='custom-popup' ></div>

<style>
#mapid { height: 100vh; width: 150vh; }
</style>



<script>

var map = L
      .map('mapid', {closePopupOnClick: false})
      .setView([18.9990, 72.8411], 9);

      // var map = L.map('map', { closePopupOnClick: false}).setView([39.7392, -104.9903], 17);

// Tile type: openstreetmap normal
var openstreetmap = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Map: &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
      minZoom: 12,
      maxZoom: 14
    })


//https://leafletjs.com/examples/quick-start/

L.svg().addTo(map);

var g = d3.select("#mapid").select("svg"); // Condenses the SVG selection into g

        g.append("text")
            // .attr("id", (d) => "ConstituencyNameText" ) 
            .attr("x", -1000)
            .attr("y", -1000)
            .style("font-family", "Georgia")
            .style("font-weight", "bold")
            .style("font-size", "20px")
            .text("Welcome!");

var places = d3.csv("places.csv");

Promise.all([places]).then(
    function(values)
    {    
        g.selectAll("circle")
            .data(values[0])
            .enter()
            .append("circle")
            .attr("cx", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).x })
            .attr("cy", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).y })
            .attr("r", "10px")
            .style("fill", function(d){ if(d.Type=="residential") { return "red"; } else { return "blue"; } })
            .attr("id", function(d, i){ return "circle" + i; })
            .on("mouseover", function (d, i){ d3.select("#circle" + i).attr("r", "20px"); d3.select("#text" + i).attr("fill", "blue");})
            .on("mouseout", function (d, i){ d3.select("#circle" + i).attr("r", "10px"); d3.select("#text" + i).attr("fill", "red");}),
            // .style("fill", function (d)
            // {
            //  // d.total = data.get(d.id) || 0;
            //  return colorScale(d.Population)
            // }),
        g.selectAll("text")
            .data(values[0])
            .enter()
            .append("text")
            .text(function(d) { return d.Name; })
            .attr("x", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).x + 15; })
            .attr("y", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).y + 5; })
            .attr("fill", "red")
            .attr("id", function(d, i){ return "text" + i; })
            .on("mouseover", function (d, i){ d3.select("#circle" + i).attr("r", "20px"); d3.select("#text" + i).attr("fill", "blue");})
            .on("mouseout", function (d, i){ d3.select("#circle" + i).attr("r", "10px"); d3.select("#text" + i).attr("fill", "red");});
    }
  );









  function update() {
      d3.selectAll("circle")
        .attr("cx", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).x })
        .attr("cy", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).y });

      d3.selectAll("text")
        .attr("x", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).x + 15; })
        .attr("y", function(d){ return map.latLngToLayerPoint([d.Lat, d.Lon]).y + 5; })
    }

    map.on("moveend", update)

var origin_lat = 19.0605751;
var origin_lon = 72.8626837;
var dest_lat = 18.9347773;
var dest_lon = 72.8217133;

//https://www.liedman.net/leaflet-routing-machine/tutorials/basic-usage/
L.Routing.control({
  createMarker: function() { return null; },
  waypoints: [
    L.latLng(origin_lat, origin_lon),
    L.latLng(dest_lat, dest_lon)
  ],
  lineOptions: { styles: [{color: 'navy', opacity: 1, weight: 5}]},
  routeWhileDragging: false,
  geometryOnly: true,
  show: false,
  addWaypoints: false
}).addTo(map);


 openstreetmap.addTo(map);


    </script>
